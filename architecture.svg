<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="728px" preserveAspectRatio="none" style="width:1630px;height:728px;" version="1.1" viewBox="0 0 1630 728" width="1630px" zoomAndPan="magnify"><defs><filter height="300%" id="fk7ke9vz9jieb" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--MD5=[6405ae9990c89da59737019f2c2eb020]
cluster Client / VFS--><polygon fill="#FFFFFF" filter="url(#fk7ke9vz9jieb)" points="219,80,315,80,322,102.2969,421,102.2969,421,167,219,167,219,80" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="219" x2="322" y1="102.2969" y2="102.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="223" y="94.9951">Client / VFS</text><!--MD5=[a240bb6421abb72fc7c4aff6301d39bd]
cluster MDS / Metadata--><polygon fill="#FFFFFF" filter="url(#fk7ke9vz9jieb)" points="555,231,682,231,689,253.2969,1181,253.2969,1181,467,555,467,555,231" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="555" x2="689" y1="253.2969" y2="253.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="121" x="559" y="245.9951">MDS / Metadata</text><!--MD5=[2143a6d7a95702e73d935edfc50c4ec6]
cluster Volume Registry / Persistence--><polygon fill="#FFFFFF" filter="url(#fk7ke9vz9jieb)" points="1154,516,1398,516,1405,538.2969,1408,538.2969,1408,716,1154,716,1154,516" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1154" x2="1405" y1="538.2969" y2="538.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="238" x="1158" y="530.9951">Volume Registry / Persistence</text><!--MD5=[474692d7e2567a1f728b62a2e4ccd1b8]
cluster Data Plane--><polygon fill="#FFFFFF" filter="url(#fk7ke9vz9jieb)" points="22,380,111,380,118,402.2969,531,402.2969,531,716,22,716,22,380" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="22" x2="118" y1="402.2969" y2="402.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="26" y="394.9951">Data Plane</text><!--MD5=[a3a458535fdcfbbb6367078bc381dc55]
cluster Clients--><polygon fill="#FFFFFF" filter="url(#fk7ke9vz9jieb)" points="1205,380,1265,380,1272,402.2969,1371,402.2969,1371,467,1205,467,1205,380" style="stroke: #000000; stroke-width: 1.5;"/><line style="stroke: #000000; stroke-width: 1.5;" x1="1205" x2="1272" y1="402.2969" y2="402.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="1209" y="394.9951">Clients</text><!--MD5=[02b0da7e54b74cbea8f6462e138178e8]
entity FS--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="170" x="235" y="115"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="230" y="120"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="230" y="141.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="150" x="245" y="137.9951">FileSystem (VFS_new)</text><!--MD5=[4dce9a88c4048c0db55becc82420917f]
entity MDS--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="748.5" y="266"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="743.5" y="271"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="743.5" y="292.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="758.5" y="288.9951">MdsServer</text><!--MD5=[500cbb48f11672748bd232e43b6f5251]
entity META--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="144" x="571" y="415"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="566" y="420"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="566" y="441.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="581" y="437.9951">MetadataManager</text><!--MD5=[f5cb714f897490c1bd63b37a4aed115c]
entity DIR--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="76" x="757" y="415"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="752" y="420"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="752" y="441.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="767" y="437.9951">DirStore</text><!--MD5=[611b4d6da5bb26d908a4ef848d18de79]
entity ALLOC--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="131" x="949.5" y="415"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="944.5" y="420"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="944.5" y="441.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="959.5" y="437.9951">VolumeAllocator</text><!--MD5=[6bd06a1bd0fbc371ee4f4f2dbeeb4981]
entity REG_IF--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="131" x="1213.5" y="551"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="1208.5" y="556"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="1208.5" y="577.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1223.5" y="573.9951">IVolumeRegistry</text><!--MD5=[fc0737e85296f1bad8c4db7bb0670364]
entity FILE_REG--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="1205.5" y="664"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="1200.5" y="669"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="1200.5" y="690.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="131" x="1215.5" y="686.9951">FileVolumeRegistry</text><!--MD5=[da9a090cab3469f9008c367ee09c62c2]
entity VMGR--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="132" x="194" y="415"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="189" y="420"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="189" y="441.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="204" y="437.9951">VolumeManager</text><!--MD5=[9d0f3863afae1f0f03d6383ef0ea2973]
entity GATE--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="42" y="551"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="37" y="556"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="37" y="577.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="52" y="573.9951">IIOGateway</text><!--MD5=[5934b2103da2e0b5f70b7ef8f368c3c0]
entity LOCAL_GW--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="38" y="664"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="33" y="669"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="33" y="690.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="48" y="686.9951">LocalStorageGateway</text><!--MD5=[347edd1aec85f4afbcafa8953e40a06b]
entity VOL--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="72" x="224" y="551"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="219" y="556"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="219" y="577.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="234" y="573.9951">Volume</text><!--MD5=[8543611870b6d5ae14a2aa1ddb7b63fd]
entity BM--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="241" y="664"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="236" y="669"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="236" y="690.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="251" y="686.9951">BlockManager</text><!--MD5=[eba0cff80908b8e4de5ffec1d1b07bfb]
entity BSC--><rect fill="#FEFECE" filter="url(#fk7ke9vz9jieb)" height="36.2969" style="stroke: #A80036; stroke-width: 1.5;" width="134" x="1221" y="415"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="1216" y="420"/><rect fill="#FEFECE" height="5" style="stroke: #A80036; stroke-width: 1.5;" width="10" x="1216" y="441.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1231" y="437.9951">BlockStoreClient</text><path d="M60,8 L60,33.1328 A0,0 0 0 0 60,33.1328 L316,33.1328 L320,114.86 L324,33.1328 L580,33.1328 A0,0 0 0 0 580,33.1328 L580,18 L570,8 L60,8 A0,0 0 0 0 60,8 " fill="#FBFB77" filter="url(#fk7ke9vz9jieb)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M570,8 L570,18 L580,18 L570,8 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="499" x="66" y="25.0669">FileSystem is thin: validate/forward to MDS,\nuse VolumeManager for data I/O.</text><path d="M615,120.5 L615,145.6328 A0,0 0 0 0 615,145.6328 L791,145.6328 L795,265.52 L799,145.6328 L975,145.6328 A0,0 0 0 0 975,145.6328 L975,130.5 L965,120.5 L615,120.5 A0,0 0 0 0 615,120.5 " fill="#FBFB77" filter="url(#fk7ke9vz9jieb)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M965,120.5 L965,130.5 L975,130.5 L965,120.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="621" y="137.5669">MDS centralizes allocation &amp; persistent registry calls.</text><!--MD5=[248a5b490391152913d01da651ca38fd]
link FS to MDS--><path d="M354.04,151.15 C390.6,169.04 450.78,196.94 505,215 C586.56,242.16 684.48,262.72 743.12,273.8 " fill="none" id="FS-&gt;MDS" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="748.32,274.78,740.2192,269.1785,743.4069,273.8517,738.7338,277.0394,748.32,274.78" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="222" x="535" y="196.0669">CreateFile/RemoveFile/TruncateFile</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="506" y="211.1997">RegisterVolume/LookupIno/FindInodeByPath</text><!--MD5=[a119cd6c07a45f37c5afb40eeafd9d07]
link FS to VMGR--><path d="M316.51,151.31 C306.24,202.33 276.08,352.14 264.55,409.4 " fill="none" id="FS-&gt;VMGR" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="263.49,414.64,269.1864,406.6056,264.4761,409.7382,261.3435,405.0279,263.49,414.64" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="344.5" y="281.0669">write_file/read_file</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="303" y="296.1997">register_volume (local IO path)</text><!--MD5=[5eb62c07ac2e350b55807bfb67f436c7]
link MDS to META--><path d="M748.35,292.3 C705.89,300.01 647.8,313.6 634,332 C617.18,354.43 625.05,388.15 633.22,410.12 " fill="none" id="MDS-&gt;META" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="635.07,414.89,635.5404,405.0524,633.2598,410.2292,628.083,407.9486,635.07,414.89" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="635" y="345.0669">read_inode/write_inode</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="662.5" y="360.1997">allocate_inode</text><!--MD5=[2c0eb26996793e9a7c8b987cf840d21b]
link MDS to DIR--><path d="M793.62,302.4 C792.99,311.25 792.31,322.19 792,332 C791.15,358.61 792.4,389.21 793.53,409.48 " fill="none" id="MDS-&gt;DIR" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="793.83,414.66,797.2838,405.4366,793.5305,409.669,789.2982,405.9157,793.83,414.66" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="793" y="352.5669">add/remove/read dir entries</text><!--MD5=[0c549cb970d70690481d6a4445426862]
link MDS to ALLOC--><path d="M841.69,285.71 C881.84,288.73 938.99,299.11 976,332 C998.66,352.14 1008.27,387.07 1012.27,409.86 " fill="none" id="MDS-&gt;ALLOC" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1013.08,414.81,1015.5639,405.2795,1012.2673,409.8765,1007.6703,406.5799,1013.08,414.81" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1009" y="345.0669">allocate_for_inode()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="998" y="360.1997">free_blocks_for_inode()</text><!--MD5=[a599bfb0008864e99acee42d73d56fee]
link ALLOC to REG_IF--><path d="M1047.83,451.07 C1073.65,464.46 1110.56,483.53 1143,500 C1175.6,516.55 1212.73,535.1 1239.94,548.63 " fill="none" id="ALLOC-&gt;REG_IF" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1244.57,550.93,1238.2993,543.3354,1240.095,548.6997,1234.7307,550.4954,1244.57,550.93" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="1144" y="496.0669">list()/find_by_uuid()</text><!--MD5=[b6bb3f4f32bd93703320b46b4333dec7]
link ALLOC to VOL--><path d="M952.22,451.09 C921.8,459.01 884.65,468.16 851,475 C646.01,516.67 397.78,550.33 301.21,562.8 " fill="none" id="ALLOC-&gt;VOL" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="296.18,563.45,305.6197,566.2593,301.1385,562.807,304.5908,558.3258,296.18,563.45" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="804" y="496.0669">free_blocks(segment)</text><!--MD5=[6603033c4338336c81907d5dff2529a7]
reverse link REG_IF to FILE_REG--><path d="M1279.4,592.47 C1279.78,613.55 1280.34,644.6 1280.69,663.78 " fill="none" id="REG_IF&lt;-FILE_REG" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="1279.31,587.34,1275.4649,596.4072,1279.3957,592.3393,1283.4637,596.2701,1279.31,587.34" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1281" y="630.0669">implements</text><!--MD5=[9f74252d6256ebcc3e9b88e35162f346]
link MDS to REG_IF--><path d="M841.71,285.61 C964.72,288.2 1293.46,301.68 1371,372 C1414.44,411.39 1432.88,449.54 1403,500 C1389.51,522.78 1365.39,538.43 1341.99,548.92 " fill="none" id="MDS-&gt;REG_IF" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1337.32,550.95,1347.1684,551.0443,1341.9083,548.9632,1343.9895,543.7031,1337.32,550.95" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="1418" y="437.5669">RegisterVolume(...) (delegates)</text><!--MD5=[8e92b7c26365d50f152b48adc0b007cc]
link VMGR to VOL--><path d="M260,451.24 C260,475.37 260,519.2 260,545.75 " fill="none" id="VMGR-&gt;VOL" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="260,550.82,264,541.82,260,545.82,256,541.82,260,550.82" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="261" y="496.0669">allocate_blocks()/submit_io_requests()</text><!--MD5=[46345c33789ce4f7a2beb6e4a85d7698]
link VOL to BM--><path d="M266.25,587.34 C273.21,606.65 284.47,637.89 292.05,658.93 " fill="none" id="VOL-&gt;BM" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="293.79,663.78,294.4998,653.9568,292.0939,659.0765,286.9742,656.6705,293.79,663.78" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="322" x="284" y="630.0669">allocate_blocks()/free_blocks()/free_blocks_count()</text><!--MD5=[0cdc80929ec4021cf51fa9ca1d4b21e1]
link VMGR to GATE--><path d="M196.8,451.05 C177.08,458.55 156.25,468.94 140,483 C120.19,500.14 106.2,527.17 98.14,546.13 " fill="none" id="VMGR-&gt;GATE" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="96.23,550.77,103.3555,543.9709,98.1337,546.1466,95.958,540.9249,96.23,550.77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="141" y="496.0669">processIOBatch()</text><!--MD5=[fd1b073c7247a5923feda845d5fb0242]
reverse link GATE to LOCAL_GW--><path d="M75.5,591.71 C68.97,604.32 63.94,620.36 70,634 C75.28,645.9 85.24,656.06 95.03,663.86 " fill="none" id="GATE&lt;-LOCAL_GW" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><polygon fill="#A80036" points="77.96,587.23,70.1306,593.2049,75.5597,591.6162,77.1485,597.0454,77.96,587.23" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="71" y="630.0669">implements</text><!--MD5=[cc97e02bc294e081f8b3ebf1590f6e23]
link BSC to REG_IF--><path d="M1282.76,451.05 C1280.16,460.38 1277.3,472.22 1276,483 C1273.45,504.12 1274.72,528.4 1276.32,545.58 " fill="none" id="BSC-&gt;REG_IF" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1276.82,550.68,1279.9259,541.3337,1276.3338,545.7037,1271.9638,542.1116,1276.82,550.68" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="1277" y="496.0669">find_by_uuid()/list()</text><!--MD5=[4da60321b750c2423aa234386615411f]
@startuml
package "Client / VFS" {
  [FileSystem (VFS_new)] as FS
}

package "MDS / Metadata" {
  [MdsServer] as MDS
  [MetadataManager] as META
  [DirStore] as DIR
  [VolumeAllocator] as ALLOC
}

package "Volume Registry / Persistence" {
  [IVolumeRegistry] as REG_IF
  [FileVolumeRegistry] as FILE_REG
}

package "Data Plane" {
  [VolumeManager] as VMGR
  [IIOGateway] as GATE
  [LocalStorageGateway] as LOCAL_GW
  [Volume] as VOL
  [BlockManager] as BM
}

package "Clients" {
  [BlockStoreClient] as BSC
}

FS - -> MDS : CreateFile/RemoveFile/TruncateFile\nRegisterVolume/LookupIno/FindInodeByPath
FS - -> VMGR : write_file/read_file\nregister_volume (local IO path)
MDS - -> META : read_inode/write_inode\nallocate_inode
MDS - -> DIR : add/remove/read dir entries
MDS - -> ALLOC : allocate_for_inode()\nfree_blocks_for_inode()
ALLOC - -> REG_IF : list()/find_by_uuid()
ALLOC - -> VOL : free_blocks(segment)
REG_IF <.. FILE_REG : implements
MDS - -> REG_IF : RegisterVolume(...) (delegates)
VMGR - -> VOL : allocate_blocks()/submit_io_requests()
VOL - -> BM : allocate_blocks()/free_blocks()/free_blocks_count()
VMGR - -> GATE : processIOBatch()
GATE <.. LOCAL_GW : implements
BSC - -> REG_IF : find_by_uuid()/list()

note top of FS
FileSystem is thin: validate/forward to MDS,\nuse VolumeManager for data I/O.
end note

note top of MDS
MDS centralizes allocation & persistent registry calls.
end note

@enduml

PlantUML version 1.2020.02(Sun Mar 01 10:22:07 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.28+6-post-Ubuntu-1ubuntu122.04.1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>